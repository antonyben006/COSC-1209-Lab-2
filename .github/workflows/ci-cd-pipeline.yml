name: COSC 1209 CI/CD Pipeline

on:
  push:
    branches: [ "main", "develop" ]
  pull_request:
    branches: [ "main", "develop" ]
  workflow_dispatch:

jobs:
  welcome-message:
    name: Welcome Message
    runs-on: ubuntu-latest
    steps:
    - name: Echo Welcome Message
      run: echo "Hi, I am from COSC 1209 class"

  multi-os-build:
    name: Multi-OS Build
    needs: welcome-message
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        java-version: ['11']
    runs-on: ${{ matrix.os }}
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Display OS Information
      run: |
        echo "Running on: ${{ matrix.os }}"
        echo "Java Version: ${{ matrix.java-version }}"
    
    - name: Set up JDK ${{ matrix.java-version }}
      uses: actions/setup-java@v4
      with:
        java-version: ${{ matrix.java-version }}
        distribution: 'temurin'
    
    - name: Display Java Version
      run: java -version

  gradle-build:
    name: Gradle Build and Test
    needs: multi-os-build
    runs-on: ubuntu-latest
    permissions:
      contents: read
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up JDK 11
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
    
    - name: Install Gradle 7.6 directly
      run: |
        echo "Installing fresh Gradle 7.6..."
        wget -q https://services.gradle.org/distributions/gradle-7.6-bin.zip
        unzip -q gradle-7.6-bin.zip
        export PATH=$PWD/gradle-7.6/bin:$PATH
        gradle --version
        echo "GRADLE_HOME=$PWD/gradle-7.6" >> $GITHUB_ENV
        echo "$PWD/gradle-7.6/bin" >> $GITHUB_PATH
    
    - name: Build with fresh Gradle installation
      run: |
        echo "Building with Gradle 7.6..."
        gradle clean build -x test
        echo "âœ… Gradle build completed successfully!"
